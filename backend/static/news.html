<!doctype html>

{% extends 'layout.html' %}
{% load static %}


{% block content %}
<!-- end header -->
<!-- start page title -->
<section
    class="page-title-big-typography bg-dark-gray ipad-top-space-margin xs-py-0 cover-background background-position-center-top"
    style="background-image: url(https://via.placeholder.com/1920x1100);position: relative;top: -40px">
    <div class="opacity-extra-medium bg-gradient-black-green"></div>
    <div class="container">
        <div class="row align-items-center justify-content-center small-screen">
            <div class="col-xl-6 col-lg-7 col-sm-8 position-relative text-center page-title-extra-small"
                data-anime='{ "el": "childs", "translateY": [30, 0], "opacity": [0,1], "duration": 400, "delay": 0, "staggervalue": 100, "easing": "easeOutQuad" }'>
                <div>
                    <h1 class="text-uppercase mb-15px alt-font text-white opacity-6 fw-500 ls-2px"
                        data-fancy-text='{ "opacity": [0, 1], "translateY": [50, 0], "filter": ["blur(20px)", "blur(0px)"], "string": ["Latest News"], "duration": 400, "delay": 0, "speed": 50, "easing": "easeOutQuad" }'>
                    </h1>
                </div>
                <h2 class="m-auto text-white alt-font text-shadow-double-large fw-700 w-90 xl-w-100"
                    data-fancy-text='{ "opacity": [0, 1], "translateY": [50, 0], "filter": ["blur(20px)", "blur(0px)"], "string": ["Knowledge is power"], "duration": 400, "delay": 0, "speed": 50, "easing": "easeOutQuad" }'>
                </h2>
            </div>
            <div class="down-section text-center"
                data-anime='{ "translateY": [-50, 0], "opacity": [0,1], "duration": 600, "delay": 0, "staggervalue": 300, "easing": "easeOutQuad" }'>
                <a href="#down-section" class="section-link">
                    <div class="text-white">
                        <i class="line-icon-Down icon-medium"></i>
                    </div>
                </a>
            </div>
        </div>
    </div>
</section>
<!-- end page title -->
<!-- start section -->
<section id="down-section" class="background-position-center-top sm-background-image-none"
    style="background-image: url('images/vertical-line-bg.svg')">
    <div class="container">
        <ul class="blog-grid blog-wrapper grid-loading grid grid-3col xl-grid-3col lg-grid-3col md-grid-2col sm-grid-2col xs-grid-1col gutter-double-extra-large"
            data-anime='{ "el": "childs", "translateY": [50, 0], "opacity": [0,1], "duration": 1000, "willchange": "transform", "delay": 0, "staggervalue": 300, "easing": "easeOutQuad" }'>
            {% for new in news|dictsort:"date"|slice:":10" %}
            <li class="grid-sizer"></li>
            <!-- start blog item -->
            <li class="grid-item">
                <div
                    class="card border-0 border-radius-5px box-shadow-quadruple-large box-shadow-quadruple-large-hover">
                    <div class="blog-image">
                        <a href="demo-startup-blog-single-simple.html" class="d-block"><img
                                src="https://via.placeholder.com/600x430" alt="" /></a>
                        <div class="blog-categories">
                            <a href="demo-startup-blog.html"
                                class="categories-btn bg-white text-dark-gray text-dark-gray-hover text-uppercase alt-font fw-700">{{new.title}}</a>
                        </div>
                    </div>
                    <div class="card-body p-13 md-p-11">
                        <a href="{% url 'new_detail' pk=new.pk %}"
                            class="card-title mb-15px alt-font fw-700 fs-18 lh-30 text-dark-gray text-dark-gray-hover d-inline-block">{{new.subtitle}}</a>
                        <p>{{new.content|truncatewords:30 }}</p>
                        <img src="{{ new.image.url }}" alt="new-image" class="mt-10px mb-20px" />
                        <div
                            class="author d-flex justify-content-center align-items-center position-relative overflow-hidden fs-14 text-uppercase">
                            <div class="me-auto">
                                <span class="blog-date d-inline-block">{{new.date}}</span>
                                <div class="d-inline-block author-name">By <a href="demo-startup-blog.html"
                                        class="text-dark-gray text-dark-gray-hover text-decoration-line-bottom fw-500">Den
                                        viliamson</a></div>
                            </div>

                            <div class="like-count">
                                <a href="demo-startup-blog-single-simple.html"><i
                                        class="fa-regular fa-heart text-base-color"></i><span
                                        class="text-dark-gray align-middle fw-500">25</span></a>
                            </div>
                        </div>
                    </div>
                </div>
            </li>
            {% endfor %}
            <!-- end blog item -->
        </ul>
        <div class="row">
            <!-- Contenedor de noticias -->
            <div class="col-12 mt-4">
                <ul id="news-list" class="list-unstyled"></ul>
            </div>

            <!-- Paginación -->
            <div class="col-12 mt-4 d-flex justify-content-center">
                <ul id="pagination" class="pagination pagination-style-01 fs-13 mb-0"
                    data-anime='{ "translate": [0, 0], "opacity": [0,1], "duration": 600, "delay": 100, "staggervalue": 150, "easing": "easeOutQuad" }'>
                </ul>
            </div>
        </div>
        <script>


            const newsList = document.getElementById('news-list');
            const pagination = document.getElementById('pagination');

            function fetchPage(page = 1) {
                 fetch(`/home/news/?page=${page}`, {
                    headers: { 'X-Requested-With': 'XMLHttpRequest' }
                })
                    .then(res => {
                        return res.json();
                    })
                    .then(data => {


                        renderPagination(data.total_pages, page);
                    })
                    .catch(err => console.error("Error en fetchPage:", err));
            }


            function renderPagination(totalPages, currentPage) {
                pagination.innerHTML = '';
                const prev = document.createElement('li');
                prev.className = 'page-item';
                prev.innerHTML = `<a class="page-link" href="#"><i class="feather icon-feather-arrow-left fs-18 d-xs-none"></i></a>`;
                if (currentPage > 1) {
                    prev.querySelector('a').onclick = () => fetchPage(currentPage - 1);
                } else {
                    prev.classList.add('disabled');
                }
                pagination.appendChild(prev);

                for (let i = 1; i <= totalPages; i++) {
                    const li = document.createElement('li');
                    li.className = 'page-item' + (i === currentPage ? ' active' : '');
                    li.innerHTML = `<a class="page-link" href="#">${String(i).padStart(2, '0')}</a>`;
                    li.querySelector('a').onclick = () => fetchPage(i);
                    pagination.appendChild(li);
                }

                const next = document.createElement('li');
                next.className = 'page-item';
                next.innerHTML = `<a class="page-link" href="#"><i class="feather icon-feather-arrow-right fs-18 d-xs-none"></i></a>`;
                if (currentPage < totalPages) {
                    next.querySelector('a').onclick = () => fetchPage(currentPage + 1);
                } else {
                    next.classList.add('disabled');
                }
                pagination.appendChild(next);
            }

            fetchPage(); // carga inicial
        </script>


    </div>
    </div>
    </div>
</section>
<!-- end section -->
<!-- start footer -->

{% endblock %}